<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>X Layer 链上日记</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9fafb; }
    h1 { color: #333; }
    textarea { width: 100%; height: 120px; margin-top: 10px; padding: 10px; }
    button { padding: 10px 20px; margin-top: 10px; cursor: pointer; border: none;
             background: #4f46e5; color: white; border-radius: 8px; font-size: 16px; }
    #status { margin-top: 15px; font-family: monospace; color: #555; }
  </style>
</head>
<body>
  <h1>📓 X Layer 链上日记 (Memo)</h1>
  <p>写下你的日记，点击按钮即可铭刻在链上。</p>
  <textarea id="diary" placeholder="今天想记录点什么？"></textarea><br/>
  <button onclick="sendDiary()">✍️ 铭刻日记</button>
  <div id="status"></div>

  <script>
    async function sendDiary() {
      const status = document.getElementById("status");
      const diaryText = document.getElementById("diary").value.trim();

      if (!diaryText) {
        status.innerText = "⚠️ 请输入内容";
        return;
      }

      if (!window.ethereum) {
        status.innerText = "❌ 请先安装 MetaMask";
        return;
      }

      try {
        await ethereum.request({ method: "eth_requestAccounts" });
        const provider = new ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();

        // 转给自己地址
        const to = await signer.getAddress();
        const dataHex = ethers.hexlify(ethers.toUtf8Bytes(diaryText));

        const tx = await signer.sendTransaction({
          to,
          value: 0,
          data: dataHex
        });

        status.innerText = "⏳ 交易发送中: " + tx.hash;
        const receipt = await tx.wait();
        status.innerText = "✅ 铭刻完成! 区块号: " + receipt.blockNumber + 
                           "\n交易哈希: " + tx.hash;
      } catch (err) {
        console.error(err);
        status.innerText = "❌ 出错: " + err.message;
      }
    }
  </script>
</body>
</html>
