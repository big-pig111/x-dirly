<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>X Layer é“¾ä¸Šæ—¥è®°</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9fafb; }
    h1 { color: #333; }
    textarea { width: 100%; height: 120px; margin-top: 10px; padding: 10px; }
    button { padding: 10px 20px; margin-top: 10px; cursor: pointer; border: none;
             background: #4f46e5; color: white; border-radius: 8px; font-size: 16px; }
    #status { margin-top: 15px; font-family: monospace; color: #555; }
  </style>
</head>
<body>
  <h1>ğŸ““ X Layer é“¾ä¸Šæ—¥è®° (Memo)</h1>
  <p>å†™ä¸‹ä½ çš„æ—¥è®°ï¼Œç‚¹å‡»æŒ‰é’®å³å¯é“­åˆ»åœ¨é“¾ä¸Šã€‚</p>
  <textarea id="diary" placeholder="ä»Šå¤©æƒ³è®°å½•ç‚¹ä»€ä¹ˆï¼Ÿ"></textarea><br/>
  <button onclick="sendDiary()">âœï¸ é“­åˆ»æ—¥è®°</button>
  <div id="status"></div>

  <script>
    async function sendDiary() {
      const status = document.getElementById("status");
      const diaryText = document.getElementById("diary").value.trim();

      if (!diaryText) {
        status.innerText = "âš ï¸ è¯·è¾“å…¥å†…å®¹";
        return;
      }

      if (!window.ethereum) {
        status.innerText = "âŒ è¯·å…ˆå®‰è£… MetaMask";
        return;
      }

      try {
        await ethereum.request({ method: "eth_requestAccounts" });
        const provider = new ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();

        // è½¬ç»™è‡ªå·±åœ°å€
        const to = await signer.getAddress();
        const dataHex = ethers.hexlify(ethers.toUtf8Bytes(diaryText));

        const tx = await signer.sendTransaction({
          to,
          value: 0,
          data: dataHex
        });

        status.innerText = "â³ äº¤æ˜“å‘é€ä¸­: " + tx.hash;
        const receipt = await tx.wait();
        status.innerText = "âœ… é“­åˆ»å®Œæˆ! åŒºå—å·: " + receipt.blockNumber + 
                           "\näº¤æ˜“å“ˆå¸Œ: " + tx.hash;
      } catch (err) {
        console.error(err);
        status.innerText = "âŒ å‡ºé”™: " + err.message;
      }
    }
  </script>
</body>
</html>
